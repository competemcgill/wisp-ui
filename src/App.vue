<template>
  <v-app>
    <app-navbar />
    <v-content class="ma-5">
      <router-view></router-view>
    </v-content>
  </v-app>
</template>

<script>
import { api } from "@/gateways/wisp-api";
import { eventBus } from "@/store/eventBus";
import Navbar from "@/components/Shared/NavBar";

export default {
  name: "App",

  components: {
    "app-navbar": Navbar
  },

  async created() {
    if (this.$store.state.token) {
      Promise.all([this.getProblemSets(), this.getProblems()]);
    }

    eventBus.$on("LOGIN_SUCCESS", () => {
      Promise.all([this.getProblemSets(), this.getProblems()]);
    });
  },

  methods: {
    async getProblemSets() {
      const response = await api.get("/problemSets?includeProblems=true", {
        headers: {
          Authorization: this.$store.state.token
        }
      });
      const problemSets = response.data;
      this.$store.dispatch("setProblemSets", problemSets);
    },
    async getProblems() {
      const problemsResponse = await api.get("/problems", {
        headers: {
          Authorization: this.$store.state.token
        }
      });
      const problems = problemsResponse.data;
      this.$store.dispatch("setProblems", problems);
    }
  }
};
</script>
